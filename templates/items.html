{% extends "homepage.html" %}

{% block title %}
Item Details
{% endblock %}

{% block body %}
<h1>Item Details</h1>
<button class="want-it-btn" data-item-id="{{ item.id }}" data-uploaded-by-id="{{ item.uploadedBy }}">I Want It</button>
<div>
    <h2>{{ item.title }}</h2>
    <p>Description: {{ item.description }}</p>
    <p>Category: {{ item.category }}</p>
    <p>Other: {{ item.other }}</p>
    <p>Ingredients: {{ item.ingredients }}</p>
    <p>Quantity: {{ item.quantity }}</p>
    <p>Expiry Date: {{ item.expiry_date }}</p>
    <p>Location: {{ item.location }}</p>
    <p>Uploaded By: {{ item.uploadedBy }}</p>
    <img src="{{ item.image_url }}" alt="{{ item.title }}">
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Define the URL for the create chatroom endpoint
        var createChatroomUrl = "/create_chatroom";

        // Attach a click event listener to the "I want it" buttons
        $(document).on('click', '.want-it-btn', function () {
            // Get the item ID associated with the button
            var itemId = $(this).data('item-id');
            // Get the uploaded by ID associated with the button
            var uploadedById = $(this).data('uploaded-by-id');

            // Make a POST request to create chatroom
            $.post('/create_chatroom', { item_id: itemId, uploaded_by_id: uploadedById })
                .done(function (data) {
                    // Redirect to the chats page after creating the chatroom
                    window.location.href = '/chats';
                })
                .fail(function (xhr, status, error) {
                    // Handle failure
                    console.error('Failed to create chatroom:', error);
                });
        });
    });
</script>
{% endblock %}
