{% extends "homepage.html" %}

{% block title %}
Nourished 
{% endblock %}

{% block body %}
    <h1>Listing Filter</h1>
    
    <form method="POST" action="/nourished">
        <label for="allergies">Allergies/ Dietary Restrictions(if any):</label>
        <input type="text" name="allergy" id="allergy">
        <input type="submit" value="Submit">
    </form>
    

    <label for="category-filter">Select a category:</label>
    <select id="category-filter">
        <option value="all">All Categories</option>
        <option value="Vegetables">Vegetables</option>
        <option value="Fruits">Fruits</option>
        <option value="Dairy">Dairy Products</option>
        <option value="Eggs">Eggs</option>
        <option value="Oil">Oil</option>
        <option value="Snacks">Snacks And Crackers</option>
        <option value="Canned">Canned Food</option>
        <option value="Drinks">Drinks and beverages</option>
        <option value="Dried">Dried Food</option>
        <option value="Noodles">Noodles</option>
        <option value="Rice"> Rice </option>
        <option value="Cereal"> Cereal </option>
        <option value="Bread"> Bread </option>
        <option value="Others">Others</option>
        <!-- Add more options for each category in your database -->
    </select>

    <div id="filtered-content">
        <!-- Filtered content will be displayed here -->
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- jQuery is used for AJAX, you can also use plain JavaScript -->
    <script>
         var chatUrl = "{{ url_for('chat') }}";

        $(document).ready(function () {
            // Attach an event listener to the category filter select element
            $('#category-filter').on('change', function () {
                filterItems();
            });
    
            // Attach an event listener to the allergy form submission
            $('form').submit(function (e) {
                e.preventDefault();
                filterItems();
            });
    
            function filterItems() {
                var selectedCategory = $('#category-filter').val(); // Get the selected category
                var userAllergy = $('#allergy').val(); // Get the user's allergy
    
                // Make an AJAX request to your Flask endpoint to fetch filtered data
                $.ajax({
                    url: '/api/getItems?category=' + selectedCategory + '&allergy=' + userAllergy,
                    method: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        // Clear the filtered content
                        $('#filtered-content').empty();
    
                        // Append the filtered data to the content container
                        $.each(data, function (index, item) {
                        // Customize this part to display your item data as you like
                            var itemHtml = '<div class="item">' +
                                '<a href="' + chatUrl + '">' + '<h2>' + item.title + '</h2>' + '</a>' +
                                '<p>Category: ' + item.category + '</p>' +
                                '<p>Other categories(if specified): ' + item.other + '</p>' +
                                '<p>Ingredients: ' + item.ingredients + '</p>' +
                                '<p>Quantity: ' + item.quantity + '</p>' +
                                '<p>Expiry date: ' + item.expiry_date + '</p>' +
                                '<p>Location of nourisher: ' + item.location + '</p>' +
                                // Add more item details as needed
                            '</div>';
                            $('#filtered-content').append(itemHtml);
                        });

                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });
            }
        });
    </script>
    
{% endblock %}







